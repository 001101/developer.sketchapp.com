---
title: svgo.js
layout: single-page
---
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>svgo.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>SVGO v0.1α, by Ale Muñoz — Source code available at <a href="https://github.com/BohemianCoding/plugins.examples.svgo-export">GitHub</a></p>
<p>This Plugin compresses SVG assets using <a href="https://github.com/svg/svgo">SVGO</a> right after they’re exported from Sketch.</p>
<p>It uses the new Action API in Sketch 3.8, and requires svgo to be installed in <code>/usr/local/bin</code></p>
<p>This is the content of the <code>manifest.json</code> file for this Plugin. See how we’re attaching the Plugin to the <code>ExportSlices.finish</code> event in <code>handlers.actions</code> by assigning a function name (<code>compressSVG</code>, defined in <code>svgo.js</code> to the action name we’re interested in).</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"author"</span> : <span class="hljs-string">"Ale Muñoz"</span>,
  <span class="hljs-attr">"commands"</span> : [
    {
      <span class="hljs-attr">"script"</span> : <span class="hljs-string">"svgo.js"</span>,
      <span class="hljs-attr">"name"</span> : <span class="hljs-string">"SVGO"</span>,
      <span class="hljs-attr">"handlers"</span> : {
        <span class="hljs-attr">"actions"</span> : {
          <span class="hljs-attr">"ExportSlices.finish"</span>: <span class="hljs-string">"compressSVG"</span>
        }
      },
      <span class="hljs-attr">"identifier"</span> : <span class="hljs-string">"com.sketchapp.sketch.svgo"</span>
    }
  ],
  <span class="hljs-attr">"identifier"</span> : <span class="hljs-string">"com.sketchapp.sketch.8bbc676e-337d-408b-bd87-d0a4421e056e"</span>,
  <span class="hljs-attr">"version"</span> : <span class="hljs-string">"0.1α"</span>,
  <span class="hljs-attr">"description"</span> : <span class="hljs-string">"Uses SVGO to compress exported SVG assets.\nNote: it needs svgo installed somewhere on your path!"</span>,
  <span class="hljs-attr">"authorEmail"</span> : <span class="hljs-string">"ale@sketchapp.com"</span>,
  <span class="hljs-attr">"name"</span> : <span class="hljs-string">"SVGO (αlphα)"</span>
}
</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Utility function we’ll use later, to remove duplicates on an Array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> uniqueArray = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arrArg</span>) </span>{
  <span class="hljs-keyword">return</span> arrArg.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, pos,arr</span>) </span>{
    <span class="hljs-keyword">return</span> arr.indexOf(elem) == pos;
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This is the function where we’ll do the heavy lifting (i.e: compress all SVG files in a given folder).
Make sure you either have svgo installed on <code>/usr/local/bin</code> or adjust the path accordingly in the code.
The SVGO options are based on our experience working with Sketch’s exported SVGs, and to the best of our knowledge they shouldn’t effect the rendering of your assets, just reduce their size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">optimizeFolderWithSVGO</span>(<span class="hljs-params">folderPath</span>) </span>{
  <span class="hljs-keyword">var</span> command = <span class="hljs-string">"/usr/local/bin/svgo --folder='"</span> + folderPath + <span class="hljs-string">"' --pretty --disable=convertShapeToPath --enable=removeTitle --enable=removeDesc --enable=removeDoctype --enable=removeEmptyAttrs --enable=removeUnknownsAndDefaults --enable=removeUnusedNS --enable=removeEditorsNSData"</span>

  <span class="hljs-keyword">var</span> task = [[NSTask alloc] init]
  [task setLaunchPath:@<span class="hljs-string">"/bin/bash"</span>]
  [task setArguments:[<span class="hljs-string">"-l"</span>, <span class="hljs-string">"-c"</span>, command]]
  [task launch]
  [task waitUntilExit]

  <span class="hljs-keyword">if</span> ([task terminationStatus] == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>This is the handler we defined on <code>manifest.json</code> for the event (<code>ExportSlices.finish</code>). It will be passed a <code>context</code> object as a parameter.
<code>context.actionContext</code> is the action that has been triggered, and it looks like this:</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"document"</span>: <span class="hljs-string">"&lt;MSImmutableDocumentData: 0x7fbe8644fae0&gt; (6125882F-2DBB-4E1C-856B-92C6761BA0E3)"</span>,
  <span class="hljs-attr">"exports"</span>: [{
    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/Users/ale/Desktop/tmp/svgo/Rectangle.svg"</span>,
    <span class="hljs-attr">"request"</span>: <span class="hljs-string">"&lt;MSExportRequest: 0x7fbe86264300&gt;"</span>
  }]
}
</code></pre>
<p>In this particular example, there’s only one item in the <code>exports</code> array, but if you’ve exported 10.000 assets it will be a bit more crowded. The <code>ExportSlices.finish</code> event is only called once for the whole export operation, rather than being triggered 10.000 times.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> compressSVG = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
  <span class="hljs-keyword">var</span> exports = context.actionContext.exports,
      shouldCompressSVG = <span class="hljs-literal">false</span>,
      pathsToCompress = []</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We’ll take a look at the Array that contains all the exported assets…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; exports.count(); i++) {
    <span class="hljs-keyword">var</span> currentExport = exports.objectAtIndex(i)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>When we find an asset in SVG format, then we’ll want to compress the folder it’s been exported to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (currentExport.request.format() == <span class="hljs-string">'svg'</span>) {
      shouldCompressSVG = <span class="hljs-literal">true</span>
      <span class="hljs-keyword">var</span> currentPath = <span class="hljs-string">""</span> + currentExport.path.stringByDeletingLastPathComponent() <span class="hljs-comment">// the ("" + ) trick coerces the value into a JS string, otherwise the uniqueArray function won't sort the array properly</span>
      pathsToCompress.push(currentPath)
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Time to compress some folders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (shouldCompressSVG) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Let’s remove duplicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> paths = uniqueArray(pathsToCompress),
        success = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p=<span class="hljs-number">0</span>; p &lt; paths.length; p++) {
      <span class="hljs-keyword">var</span> path = paths[p]
      log(<span class="hljs-string">'Compressing SVG files in '</span> + path)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Exporting!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(optimizeFolderWithSVGO(paths[p])) {
        log(<span class="hljs-string">'✅ compression ok'</span>)
        success = <span class="hljs-literal">true</span>
      } <span class="hljs-keyword">else</span> {
        log(<span class="hljs-string">'❌ compression error'</span>)
        success = <span class="hljs-literal">false</span>
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>And finally, make some noise to let the user know if the command worked as expected or not (this can take a while if you’re exporting many assets, so it’s a nice touch :-)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> ding = [[NSTask alloc] init],
        audio = <span class="hljs-string">""</span>

    [ding setLaunchPath:@<span class="hljs-string">"/bin/bash"</span>]
    <span class="hljs-keyword">if</span> (success) {
      audio = <span class="hljs-string">"Glass"</span>
    } <span class="hljs-keyword">else</span> {
      audio = <span class="hljs-string">"Basso"</span>
    }
    [ding setArguments:[<span class="hljs-string">"-c"</span>, <span class="hljs-string">"afplay /System/Library/Sounds/"</span> + audio + <span class="hljs-string">".aiff"</span>]]
    [ding launch]
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>If you have questions, comments or any feedback, ping us at <a href="&#109;&#97;&#105;&#108;&#x74;&#111;&#58;&#100;&#x65;&#118;&#101;&#108;&#x6f;&#x70;&#x65;&#x72;&#64;&#115;&#x6b;&#x65;&#116;&#99;&#104;&#97;&#112;&#112;&#46;&#x63;&#x6f;&#x6d;">&#100;&#x65;&#118;&#101;&#108;&#x6f;&#x70;&#x65;&#x72;&#64;&#115;&#x6b;&#x65;&#116;&#99;&#104;&#97;&#112;&#112;&#46;&#x63;&#x6f;&#x6d;</a>!</p>

            </div>
            
        </li>
        
    </ul>
  </div>
